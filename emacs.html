
<!doctype html>
<html lang="en">
  <head>
    

<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

<style>
   
   
  @font-face {
    font-family: "Fira Code";
    font-style: normal;
    font-weight: 300 700;
    src: url(https://fonts.gstatic.com/s/firacode/v22/uU9NCBsR6Z2vfE9aq3bh0NSDulI.woff2)
      format("woff2");
    unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F,
      U+FE2E-FE2F;
  }
   
  @font-face {
    font-family: "Fira Code";
    font-style: normal;
    font-weight: 300 700;
    src: url(https://fonts.gstatic.com/s/firacode/v22/uU9NCBsR6Z2vfE9aq3bh2dSDulI.woff2)
      format("woff2");
    unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
  }
   
  @font-face {
    font-family: "Fira Code";
    font-style: normal;
    font-weight: 300 700;
    src: url(https://fonts.gstatic.com/s/firacode/v22/uU9NCBsR6Z2vfE9aq3bh0dSDulI.woff2)
      format("woff2");
    unicode-range: U+1F00-1FFF;
  }
   
  @font-face {
    font-family: "Fira Code";
    font-style: normal;
    font-weight: 300 700;
    src: url(https://fonts.gstatic.com/s/firacode/v22/uU9NCBsR6Z2vfE9aq3bh3tSDulI.woff2)
      format("woff2");
    unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1,
      U+03A3-03FF;
  }
   
  @font-face {
    font-family: "Fira Code";
    font-style: normal;
    font-weight: 300 700;
    src: url(https://fonts.gstatic.com/s/firacode/v22/uU9NCBsR6Z2vfE9aq3bh09SDulI.woff2)
      format("woff2");
    unicode-range: U+0100-02AF, U+0304, U+0308, U+0329, U+1E00-1E9F, U+1EF2-1EFF,
      U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
  }
   
  @font-face {
    font-family: "Fira Code";
    font-style: normal;
    font-weight: 300 700;
    src: url(https://fonts.gstatic.com/s/firacode/v22/uU9NCBsR6Z2vfE9aq3bh3dSD.woff2)
      format("woff2");
    unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA,
      U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122,
      U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
  }
</style>

<meta
  name="go-import"
  content="twos.dev
           git https://github.com/glacials/twos.dev"
/>
<meta
  name="go-source"
  content="twos.dev
           https://github.com/glacials/twos.dev
           https://github.com/glacials/twos.dev/tree/main{/dir}
           https://github.com/glacials/twos.dev/blob/main{/dir}/{file}#L{line}"
/>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<meta name="description" content="
Emacs Config
" />
<link
  rel="alternate"
  type="application/rss+xml"
  title="twos.dev"
  href="/feed.rss"
/>
<link
  rel="alternate"
  type="application/atom+xml"
  title="twos.dev"
  href="/feed.atom"
/>
<title>
  Ben Carlsson's
      
Emacs Config
</title>
<link rel="stylesheet" href="style.css" />

<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css"
  integrity="sha384-Xi8rHCmBmhbuyyhbI88391ZKP2dmfnOl4rT9ZfRI7mLTdk1wblIUnrIq35nqwEvC"
  crossorigin="anonymous"
/>
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png?v=2" />
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png?v=2" />
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png?v=2" />
<link rel="manifest" href="/site.webmanifest?v=2" />
<link rel="mask-icon" href="/safari-pinned-tab.svg?v=2" color="#5bbad5" />
<link rel="shortcut icon" href="/favicon.ico?v=2" />
<meta name="msapplication-TileColor" content="#da532c" />
<meta name="theme-color" content="#ffffff" />


  </head>

  <body>
    <div class="container">
      <nav class="primary">
  
  <h1 class="website-title">
    
Emacs Config
</h1>
  <div class="hierarchy">
      <div class="nav-wrapper">
        <a href="/"><div class="nav-text">Home</div></a>
      </div>
      <div class="nav-wrapper">
        <a href="/archives.html"><div class="nav-text">Blog</div></a>
      </div>
      <div class="nav-wrapper">
        <a href="/newsletter.html"><div class="nav-text">Newsletter</div></a>
      </div>
      <div class="nav-wrapper">
        <a href="/now.html"><div class="nav-text">Now</div></a>
      </div>
      <div class="nav-wrapper">
        <a href="/photos.html"><div class="nav-text">Photos</div></a>
      </div>
      <div class="nav-wrapper">
        <a href="/software.html"><div class="nav-text">Software</div></a>
      </div>
    </div>
  
</nav>

      <article>
        
        
        
        
          <div
            style="text-align: center; text-transform: uppercase; margin-top: 2em"
          >
            — a living document —
          </div>
        
        <html><head></head><body><div id="outline-container-headline-1" class="outline-1">

<div id="outline-text-headline-1" class="outline-text-1">
<p>
This is my Emacs config, expressed in <a href="https://en.wikipedia.org/wiki/Literate_programming" target="_blank">literate programming</a>. That is,
my Emacs config and the documentation for my Emacs config are the same
file, and it's the one you're reading (<a href="https://github.com/glacials/dotfiles/blob/main/dot_config/emacs/config.org" target="_blank">source</a>). <a href="https://twos.dev/winter" target="_blank">Winter</a> has rendered it
from Org to HTML.</p>
<div id="outline-container-headline-2" class="outline-2">
<html><head></head><body><ol id="toc">
  
    <li><a href="#headline-2"><span>
Traditional Configuration
</span></a></li>
    
  
    <li><a href="#headline-3"><span>
Small Efficiencies
</span></a></li>
    
  
    <li><a href="#headline-4"><span>
Initialization
</span></a></li>
    
  
    <li><a href="#headline-5"><span>
Visuals
</span></a></li>
    
  
    <li><a href="#headline-6"><span>
Packages
</span></a></li>
    
      <ol>
  
    <li>
      <a href="#headline-7"><span>
Formatting
</span></a>
      
    </li>
  
    <li>
      <a href="#headline-8"><span>
Integrations
</span></a>
      
    </li>
  
    <li>
      <a href="#headline-9"><span>
Autocompletion
</span></a>
      
    </li>
  
    <li>
      <a href="#headline-10"><span>
Splash Screen
</span></a>
      
    </li>
  
    <li>
      <a href="#headline-11"><span>
Language Support
</span></a>
      
    </li>
  
    <li>
      <a href="#headline-12"><span>
Display
</span></a>
      
    </li>
  
    <li>
      <a href="#headline-13"><span>
System Tweaks
</span></a>
      
    </li>
  
    <li>
      <a href="#headline-14"><span>
Org Mode
</span></a>
      
    </li>
  
    <li>
      <a href="#headline-15"><span>
Project management
</span></a>
      
    </li>
  
    <li>
      <a href="#headline-16"><span>
Newbie Helpers
</span></a>
      
    </li>
  
    <li>
      <a href="#headline-17"><span>
Efficiencies
</span></a>
      
    </li>
  
    <li>
      <a href="#headline-18"><span>
Modern Niceties
</span></a>
      
    </li>
  
</ol>

    
  
    <li><a href="#headline-19"><span>
The End
</span></a></li>
    
  
</ol>
</body></html><h2 id="headline-2">
Traditional Configuration
</h2>
<div id="outline-text-headline-2" class="outline-text-2">
<p>Get the boring stuff out of the way first:</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>	(setq-default
	 user-full-name "Benjamin Carlsson"
	 user-mail-address "ben@twos.dev")
	(setq-default tab-width 2)
	(tool-bar-mode -1) ; Don't show the GUI toolbar

	;; Modifier keys
	(setq-default mac-command-modifier 'meta)       ; Make Command act as Meta
	(setq-default mac-option-modifier 'super)       ; Make Option act as Super
	(setq-default mac-control-modifier 'control)    ; Make Control act as Control
	(setq-default mac-right-option-modifier 'hyper) ; Make Right Option act as Hyper
	(setq-default ns-function-modifier 'hyper)      ; Make Fn act as Hyper

	(setq-default ring-bell-function 'ignore)    ; Disable the audible bell
	(setq-default sentence-end-double-space nil) ; End sentences with single spaces
	(setq-default display-line-numbers t)        ; Show line numbers
	(delete-selection-mode 1)                    ; Delete selected text when starting to type
	(setq-default fill-column 80)                ; Wrap at 80 characters
	(add-hook 'prog-mode-hook #'auto-fill-mode)  ; Autowrap when coding
	(add-hook 'text-mode-hook #'auto-fill-mode)  ; Autowrap when writing
	(global-hl-line-mode 1)                      ; Highlight cursor line

	;; Unicode everywhere
	(set-charset-priority 'unicode)
	(set-default-coding-systems 'utf-8)
	(set-terminal-coding-system 'utf-8)
	(set-keyboard-coding-system 'utf-8)
	(set-selection-coding-system 'utf-8)
	(prefer-coding-system 'utf-8)
	(setq-default buffer-file-coding-system 'utf-8)
	(setq-default default-process-coding-system '(utf-8-unix . utf-8-unix))

	(when (and (eq system-type 'darwin) (display-graphic-p)))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-3" class="outline-2">
<h2 id="headline-3">
Small Efficiencies
</h2>
<div id="outline-text-headline-3" class="outline-text-2">
<p>Now we'll start with some of the less obvious stuff.</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (ido-mode 1)                              ; Autocomplete M-x among other things
  (setq-default ido-enable-flex-matching t) ; Don't require exact matches in ido-mode
  (defalias 'yes-or-no-p 'y-or-n-p)         ; Allow y/n in yes/no prompts

  ;; Make C-x k kill focused buffer instead of prompting
  (global-set-key (kbd "C-x k") #'kill-this-buffer)
</pre>
</div>
</div>
<p>
This will allow us to navigate windows using
S-&lt;up&gt;, S-&lt;down&gt;, S-&lt;left&gt;, and S-&lt;right&gt;.</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (windmove-default-keybindings)
</pre>
</div>
</div>
<p>
The following block makes dired mouseclicks open the in same window,
not a new one.</p>
<p>
For details on why this binds mouse-2 even though we're trying to
affect mouse-1, see <a href="https://emacs.stackexchange.com/questions/35536/dired-mouse-click-open-folder-in-the-same-window" target="_blank">this link</a>.</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (eval-after-load "dired"
  	'(progn
  		 (define-key
  			dired-mode-map
  			[mouse-2]
  			'dired-mouse-find-file)))
</pre>
</div>
</div>
<p>
Some keybinds:</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (global-set-key (kbd "C-c a") 'org-agenda)
</pre>
</div>
</div>
<p>
Some keybinds that work in macOS but are overridden by Emacs's use of modifiers:</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (global-set-key (kbd "s--") (lambda () (interactive) (insert "–"))) ; En dash
  (global-set-key (kbd "s-_") (lambda () (interactive) (insert "—"))) ; Em dash
</pre>
</div>
</div>
<p>
The last small thing: open this config file with <code class="verbatim">C-c i</code>:</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (global-set-key
   (kbd "C-c i")
   (lambda () (interactive)
     (find-file "~/.config/emacs/config.org")))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-4" class="outline-2">
<h2 id="headline-4">
Initialization
</h2>
<div id="outline-text-headline-4" class="outline-text-2">
<p>
When Emacs is booted it inherits a copy of the environment it was
created in. This is fine when you run <code class="verbatim">emacs</code> from the command line,
but when you start Emacs from somewhere like the macOS dock, it's
missing a lot.</p>
<p>
The most important missing variable is <code class="verbatim">$PATH</code>, as it means Emacs
can't access any CLI tools installed with Homebrew, Go, or the
like. This includes Chezmoi, <code class="verbatim">gopls</code>, a modern version of Git, etc.</p>
<p>
The following code block installs <code class="verbatim">exec-path-from-shell</code>, which
fetches environment info from the shell and copies it into Emacs
explicitly.</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (straight-use-package 'exec-path-from-shell)
  (when (memq window-system '(mac ns x)) (exec-path-from-shell-initialize))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-5" class="outline-2">
<h2 id="headline-5">
Visuals
</h2>
<div id="outline-text-headline-5" class="outline-text-2">
<p>This section deals with minimizing visual noise and making things pretty.</p>
<p>
Set font:</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (add-to-list 'default-frame-alist '(font . "JetBrains Mono" ))
  (set-face-attribute 'default t :font "JetBrains Mono" )
</pre>
</div>
</div>
<p>
By default, Emacs's BufferMenu feature opens with <code class="verbatim">C-c C-b</code>.
This opens a buffer that displays all open buffers and their statuses.</p>
<p>
Since Emacs 22, IBuffer Mode accomplishes the same thing but with a more modern
and advanced feature set and display.
We'll simply override the BufferMenu to use IBuffer Mode instead:</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (global-set-key (kbd "C-x C-b") 'ibuffer)
</pre>
</div>
</div>
<p>
More:</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  ;; Delete-auto-save-files
  (setq-default delete-auto-save-files t)

  ;; Don't pollute project directories; save backup files in a central location.
  (when (not (file-exists-p "~/.cache/emacs"))
    (make-directory "~/.cache/emacs"))

  (setq-default backup-directory-alist
                '((".*" . "~/.cache/emacs")))
  (setq-default auto-save-file-name-transforms
  							'((".*" "~/.cache/emacs/" t)))

  ;; Delete old backups silently.
  (setq-default delete-old-versions t)

  ;; Ligatures, to be provided by major modes.
  (global-prettify-symbols-mode +1)

  ;; Custom ligatures
  (setq-default prettify-symbols-alist
  							'(("TODO"        . "")
  								("BLKD"        . "")        
  								("CNCL"        . "")
  								("DONE"        . "")
  								("-&gt;&gt;"         . "↠")
  								("-&gt;"          . "→")
  								("&lt;-"          . "←")
  								("&lt;-"          . "←")
  								("=&gt;"          . "⇒")
  								("&lt;="          . "≤")
  								("&gt;="          . "≥")
  								("#+BEGIN_SRC" . "")
  								("#+END_SRC"   . "―")
  								;; Below are commented until/unless I start using them frequently.
  																				;				("[#A]" . "")
  																				;				("[#B]" . "")
  																				;				("[#C]" . "")
  																				;				("[ ]" . "")
  																				;				("[X]" . "")
  																				;				("[-]" . "")
  																				;				(":PROPERTIES:" . "")
  																				;				(":END:" . "―")
  																				;				("#+STARTUP:" . "")
  																				;				("#+TITLE: " . "")
  																				;				("#+RESULTS:" . "")
  																				;				("#+NAME:" . "")
  																				;				("#+ROAM_TAGS:" . "")
  																				;				("#+FILETAGS:" . "")
  																				;				("#+HTML_HEAD:" . "")
  																				;				("#+SUBTITLE:" . "")
  																				;				("#+AUTHOR:" . "")
  																				;				(":Effort:" . "")
  																				;				("SCHEDULED:" . "")
  																				;				("DEADLINE:" . "")
  								))
</pre>
</div>
</div>
<pre class="example">((TODO . ) (BLKD . ) (CNCL . ) (DONE . ) (-&gt;&gt; . ↠) (-&gt; . →) (&lt;- . ←) (&lt;- . ←) (=&gt; . ⇒) (&lt;= . ≤) (&gt;= . ≥) (#+BEGIN_SRC . ) (#+END_SRC . ―))
</pre>
</div>
</div>
<div id="outline-container-headline-6" class="outline-2">
<h2 id="headline-6">
Packages
</h2>
<div id="outline-text-headline-6" class="outline-text-2">
<p>
The meat of it.</p>
<div id="outline-container-headline-7" class="outline-3">
<h3 id="headline-7">
Formatting
</h3>
<div id="outline-text-headline-7" class="outline-text-3">
<p>
The following package and associated settings deal with indentation and
formatting on a language-agnostic basis.</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (straight-use-package 'ws-butler)
  (require 'ws-butler)
  (add-hook 'prog-mode-hook #'ws-butler-mode)
</pre>
</div>
</div>
<p>
Some automatic indentation:</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (straight-use-package 'aggressive-indent-mode)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-8" class="outline-3">
<h3 id="headline-8">
Integrations
</h3>
<div id="outline-text-headline-8" class="outline-text-3">
<p>
Magit is the de facto Git interface in Emacs. This package surprised
me with its convenience; having come from Vim I was expecting
something along the lines of <a href="https://github.com/tpope/vim-fugitive" target="_blank">fugitive.vim</a>, but Magit is far more
efficient than that. It's even more efficient to open Emacs and use
Magit than it is to use Git at the command line.</p>
<p>
Once you're in a Magit buffer, you can do things like stage files with
<code class="verbatim">s</code>, commit with <code class="verbatim">c c</code>, push with <code class="verbatim">p p</code>, and all of it with way more
nuance than that happy path. I'm a born <code class="verbatim">git add -p</code> user, and a Magit
diff buffer is basically the better version of that.</p>
<p>
Note that Magit <em>must</em> be loaded before <code class="verbatim">chezmoi</code>, as <code class="verbatim">chezmoi</code> needs
to load <code class="verbatim">chezmoi-magit</code> which depends on <code class="verbatim">magit</code>.</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (straight-use-package 'magit)
</pre>
</div>
</div>
<p>
Chezmoi is a CLI tool unrelated to Emacs that helps manage dotfiles.
It takes the rigmarole of managing them with a Git repository and adds
some quality-of-life improvements to it, like <code>chezmoi edit --apply
~/path/to/dotfile</code> to open your file in <code class="verbatim">$EDITOR</code>, then (once closed)
immediately add, commit, and push it without any further interaction.</p>
<p>
The <code class="verbatim">chezmoi</code> Emacs package adds some of its feature set to Emacs, but
don't use it unless you're already a <code class="verbatim">chezmoi</code> user.</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (straight-use-package 'chezmoi)  ; Dotfiles management
  (require 'chezmoi)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-9" class="outline-3">
<h3 id="headline-9">
Autocompletion
</h3>
<div id="outline-text-headline-9" class="outline-text-3">
<p>
The next code block sets up autocompletion with <code class="verbatim">company</code>, the most
popular generic autocompletion package for Emacs. Generally, LSP
servers will call out to <code class="verbatim">company</code> to display autocompletions in a
minibuffer near point.</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (straight-use-package 'company)
  (setq-default company-idle-delay 0)
  (setq-default company-minimum-prefix-length 1)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-10" class="outline-3">
<h3 id="headline-10">
Splash Screen
</h3>
<div id="outline-text-headline-10" class="outline-text-3">
<p>
The following code sets up the splash screen that shows when Emacs
boots, which is usually an empty buffer. It pulls some info from
history like recent files and projects opened, and some info from
<code class="verbatim">org-mode</code> like upcoming agenda. I also configure mine here to shell
out to <code class="verbatim">fortune</code> to render a random quote from my <a href="https://github.com/glacials/dotfiles" target="_blank">dotfiles repo</a>.</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (straight-use-package 'dashboard)
  (setq-default dashboard-items '((recents . 5)
  																(agenda . 5)
  																(bookmarks . 5)
  																(projects . 5)
  																(registers . 5)))
  (setq-default dashboard-banner-logo-title
  							(shell-command-to-string "fortune ~/.config/fortune"))
  (setq-default dashboard-startup-banner 'logo)
  (require 'dashboard)
  (dashboard-setup-startup-hook)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-11" class="outline-3">
<h3 id="headline-11">
Language Support
</h3>
<div id="outline-text-headline-11" class="outline-text-3">
<p>This section loads various types of support for programming languages, markups, and similar.</p>
<p>
And how can we do any of that without the miracle of LSP and an appropriate UI for it?</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (straight-use-package 'lsp-mode)
  (straight-use-package 'lsp-ui)
</pre>
</div>
</div>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (straight-use-package 'flycheck)
</pre>
</div>
</div>
<p>
We'll also add tree-sitter bindings:</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (straight-use-package 'tree-sitter)
  (straight-use-package 'tree-sitter-langs)

  (require 'tree-sitter)
  (require 'tree-sitter-langs)

  (global-tree-sitter-mode)
  (add-hook 'tree-sitter-after-on-hook #'tree-sitter-hl-mode)
</pre>
</div>
</div>
<p>
For Go, we need to do some work to automatically run <code class="verbatim">gofmt</code> and friends:</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (straight-use-package 'go-mode)
  (defun lsp-go-install-save-hooks ()
    (add-hook 'before-save-hook #'lsp-format-buffer t t)
    (add-hook 'before-save-hook #'lsp-organize-imports t t))
  (add-hook 'go-mode-hook #'lsp-go-install-save-hooks)
  (add-hook 'go-mode-hook #'lsp-deferred)
</pre>
</div>
</div>
<p>
For Ruby:</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (add-hook 'ruby-mode-hook #'lsp) ; Init LSP whenever Ruby mode is entered

  (straight-use-package 'rubocop)
  (require 'rubocop)
  (add-hook 'ruby-mode-hook #'rubocop-mode) ; Enter Rubocop mode whenever Ruby mode is entered
  (setq rubocop-autocorect-on-save t)       ; Autocorrect + autoformat on save
</pre>
</div>
</div>
<p>
For YAML:</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (straight-use-package 'yaml-mode)
  (require 'yaml-mode)
  (add-to-list 'auto-mode-alist '("\\.yml\\'" . yaml-mode))
  (add-hook 'yaml-mode-hook
            '(lambda ()
               (define-key yaml-mode-map "\C-m" 'newline-and-indent)))
</pre>
</div>
</div>
<p>
Finally, some support for miscellaneous languages whose packages have
good enough defaults that I don't need to configure anything.</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (straight-use-package 'dockerfile-mode)
  (straight-use-package 'git-modes)
  (straight-use-package 'hcl-mode)
  (straight-use-package 'terraform-mode)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-12" class="outline-3">
<h3 id="headline-12">
Display
</h3>
<div id="outline-text-headline-12" class="outline-text-3">
<p>A beautiful editor is important to me whether it was made in 2015 or 1976.</p>
<p>
I started my Emacs journey with <a href="https://doomemacs.org" target="_blank">Doom</a> and eventually migrated to
vanilla, but missed the Doom themeset. Thankfully, Doom is very
modular and much of their custom code is available as individual
packages. I import and use <code class="verbatim">doom-monokai-pro</code>; in some way shape or
form I've been using Monokai on and off for well over a decade.</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (straight-use-package 'doom-themes)
  (setq-default doom-themes-enable-bold t doom-themes-enable-italic t)
  (load-theme 'doom-monokai-pro t)
</pre>
</div>
</div>
<p>
Another great Doom feature is the modeline, which brings the default
Emacs mode line up to date with the modern world in terms of design
and showing information in a considerate manner.</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (straight-use-package 'doom-modeline)
  (require 'doom-modeline)
  (doom-modeline-mode 1)
</pre>
</div>
</div>
<p>
Marginalia adds Emacs function docstrings to the live suggestions in
the <code class="verbatim">M-x</code> menu; a must-have for any beginner.</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (straight-use-package 'marginalia)
  (marginalia-mode)
</pre>
</div>
</div>
<p>
And some final small tweaks:</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  ;; Color-coordinate each pair of parentheses
  (straight-use-package 'rainbow-delimiters)
  (add-hook 'prog-mode-hook #'rainbow-delimiters-mode)

  ;; Colorize mentions of colors in files
  (straight-use-package 'rainbow-mode)

  ;; Show Git changes in the gutter
  (straight-use-package 'diff-hl)
  (global-diff-hl-mode)

  ;; Show trailing whitespace
  (straight-use-package  'whitespace)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-13" class="outline-3">
<h3 id="headline-13">
System Tweaks
</h3>
<div id="outline-text-headline-13" class="outline-text-3">
<p>
<code class="verbatim">highlight-indent-guides</code> makes indentation levels visually distinct
columns down down the left side of the file, making it easy to tell at
a glance whether something 50 lines away is at a given indentation
level.</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (straight-use-package 'highlight-indent-guides)
  (add-hook 'prog-mode-hook 'highlight-indent-guides-mode)
</pre>
</div>
</div>
<p>
The following code starts the Emacs server. This allows future
invocations of <code class="verbatim">emacs</code> to open in the existing instance rather than
starting a new one.</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (load "server")
  (unless (server-running-p) (server-start))
</pre>
</div>
</div>
<p>
<code class="verbatim">mac-pseudo-daaemon</code> goes one step further by refusing to stop the
server even after the application quits. This prevents an error when
invoking Emacs from the command line without the application already
running, as the Emacs command line isn't integrated with macOS well
enough to boot the app bundle in that case.</p>
<p>
I have this disabled because it does this by pretending to quit the
application without actually doing so, so if you actually want to quit
Emacs you have to do a weird song and dance. While starting out on
Emacs I'm finding that I want to completely quit it often to make sure
my startup configs still work as intended, so the benefit wasn't worth
the sacrifice. This may change later.</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  ;; (straight-use-package 'mac-pseudo-daemon)
  ;; (mac-psuedo-daemon-mode)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-14" class="outline-3">
<h3 id="headline-14">
Org Mode
</h3>
<div id="outline-text-headline-14" class="outline-text-3">
<p>
Org Mode has already been loaded by the <code class="verbatim">straight.el</code> package in
<code class="verbatim">init.el</code> (that's how the Org file you're reading was tangled into an
<code class="verbatim">.el</code> file), so we don't need to do that here. Let's set up the rest
of Org.</p>
<p>
First, we'll set up some basic configuration.</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (setq-default org-directory "~/icloud/Documents/storage/org")
  (setq-default org-default-notes-file "~/icloud/Documents/storage/org/notes.org")
  (setq-default org-agenda-files '("~/icloud/Documents/storage/org/notes.org" "~/icloud/Documents/storage/org-roam"))
</pre>
</div>
</div>
<p>
And clean it up visually a bit:</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  ; Hide the first n-1 asterisks in level n headings
  (setq-default org-startup-indented t)

  ; Don't wrap lines in plaintext exports of Org files
  (setq-default org-export-preserve-breaks nil)
  (setq-default org-ascii-text-width 99999)
</pre>
</div>
</div>
<p>
Now, for some shortcuts to skip around Org Mode.</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  ;; Access org-mode index with C-c o
  (global-set-key
   (kbd "C-c o")
   (lambda ()
     (interactive)
     (find-file "~/icloud/Documents/storage/org/notes.org")))

  ;; Drag and drop images into Org mode
  (straight-use-package 'org-download)
  (require 'org-download)
  (add-hook 'dired-mode-hook 'org-download-enable)
</pre>
</div>
</div>
<p>
Capture is a feature built into Org Mode that allows quick insertion
to your notes no matter what file you're currently editing. This code
block sets <code class="verbatim">C-c c</code> as a capture shortcut and defines a couple of
capture templates to choose from. Starting here, you'll see that my
preferred way of using Org to take notes is to have a giant date tree
in my main Org file that looks like this:</p>
<div class="src src-org">
<div class="highlight">
<pre>  * Daily log
  ** 2023
  *** 2023-02 February
  **** 2023-02-01 Wednesday
  ***** Here lie notes for this day
  ***** These notes might stay top-level
  ****** Or be nested very deeply
  ***** TODO And I'll probably have some tasks as well
  ***** DONE Including finished ones
</pre>
</div>
</div>
<p>
Here's how we'll set up the templates. <code class="verbatim">C-c c t</code> to create a new TODO
entry, or <code class="verbatim">C-c c h</code> to create a new generic note.</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (global-set-key (kbd "C-c c") 'org-capture)
  (setq-default org-capture-templates
        '(("t"
           "Task"
           entry
           (file+olp+datetree
	    "~/icloud/Documents/storage/org/notes.org"
            "Daily log")
           "* TODO %?")
          ("h"
           "Headline"
           entry
           (file+olp+datetree
	    "~/icloud/Documents/storage/org/notes.org"
            "Daily log")
           "* %?")
          ("m"
           "Meeting"
           entry
           (file+olp+datetree
	    "~/icloud/Documents/storage/org/notes.org"
            "Daily log")
           "* %t %? :meeting:")))
</pre>
</div>
</div>
<p>
By default, the Org refile command (<code class="verbatim">C-c C-w</code>) can only refile to
shallow headlines. I currently use headlines for just about every line
of notes I take from small jots to tasks to actual headlines, so it's
important for me to be able to refile to any depth.</p>
<p>
(I'm trying to break this habit. I don't have the foresight to know
when a note will need subnotes inside it. I'm also confused about why
Org only supports tasks in headlines by default. Let me know if you
can help me with either of these things.)</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>   (setq-default org-refile-targets
         '((nil :maxlevel . 99) (org-agenda-files :maxlevel . 99)))
</pre>
</div>
</div>
<p>
Speaking of headlines, let's clean up the display of a collapsed
headline a bit:</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (setq-default org-ellipsis "⤵")
</pre>
</div>
</div>
<p>
  We'll also set up our preferred TODO keywords, and have Org autosave
  our Org file whenever we update a TODO item.</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (advice-add 'org-todo :after 'org-save-all-org-buffers)
  (setq-default org-todo-keywords
        '(
          (sequence "TODO(t)" "STRT(s)" "BLKD(b)" "|" "DONE(d)" "CNCL(c)")
          (sequence "[ ](T)" "[-](S)" "[?](B)" "|" "[X](D)" "[C](C)")
          ))
</pre>
</div>
</div>
<p>
We'll also add <a href="https://www.orgroam.com/" target="_blank">Org-roam</a>, which is like wiki mode for Org mode:</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (straight-use-package 'org-roam)
  (straight-use-package 'org-roam-ui)
  (straight-use-package 'emacsql)
  (straight-use-package 'emacsql-sqlite)
  (setq-default org-roam-directory "/Users/ben/Library/Mobile Documents/com~apple~CloudDocs/Documents/storage/org-roam")
  (org-roam-db-autosync-mode)
  (setq-default org-roam-completion-everywhere t)
</pre>
</div>
</div>
<p>
And add some more Org packages:</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  ;; Various visual improvements to Org
  (straight-use-package 'org-modern)
  (add-hook 'org-mode-hook #'org-modern-mode)
  (add-hook 'org-agenda-finalize-hook #'org-modern-agenda)
</pre>
</div>
</div>
<p>
It's time to get serious about the date tree. Because I'm always
logging notes in a nested headline for today, I want it to be easy to
get there. Capture helps us <em>put things</em> there, but I often want to
see the whole day's notes with context, edit previous entries, etc.</p>
<p>
First, we'll define a function <code class="verbatim">datetree-dates</code> to generate the title
for today's date tree headline.</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (defun datetree-dates ()
    (let (dates
          (day (string-to-number (format-time-string "%d")))
          (month (string-to-number (format-time-string "%m")))
          (year (string-to-number (format-time-string "%Y"))))
      (dotimes (i 365)
        (push
         (format-time-string
          "%F %A"
          (encode-time 1 1 0 (- day i) month year))
         dates))
      (nreverse dates)))
</pre>
</div>
</div>
<p>
Then we'll define <code class="verbatim">datetree-jump</code> to jump to that item in the current
buffer's date tree.</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (defun datetree-jump ()
    (interactive)
    (let ((point (point)))
      (catch 'found (goto-char (point-max))
             (while (outline-previous-heading)
               (let* ((hl (org-element-at-point))
                      (title (org-element-property :raw-value hl)))
                 (when (member title (datetree-dates))
                   (org-show-context)
                   (setq-default point (point))
                   (throw 'found t)))))
      (goto-char point)))
</pre>
</div>
</div>
<p>
We'll wrap <code class="verbatim">datetree-jump</code> with a new function we'll call <code class="verbatim">open-today</code>
to open the default Org file which has that date tree in it, then
call <code class="verbatim">datetree-jump</code>.</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (defun open-today () ; Open org file to today
    (interactive)
    (find-file org-default-notes-file)
    (datetree-jump))
</pre>
</div>
</div>
<p>
Finally, we'll bring it all together with <code class="verbatim">C-c t</code> to open the default
Org file, generate a heading for today's log if needed, and jump to
it.</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  ;; Jump to today in the date tree with C-c t
  (global-set-key (kbd "C-c t") 'open-today)
</pre>
</div>
</div>
<p>
This last section of my Org config is still in progress, but the goal
is to get my calendar and email readable and writable inside Emacs.</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  ;; Required to not get prompted for Touch ID every boot
  (setq-default plstore-cache-passphrase-for-symmetric-encryption t)

  (straight-use-package 'org-gcal)
  (setq
   org-gcal-client-id
   (string-trim
    (shell-command-to-string
     "op item get 'Emacs Google Client' --fields username"))
   org-gcal-client-secret
   (string-trim
    (shell-command-to-string
     "op item get 'Emacs Google Client' --fields password"))
   org-gcal-fetch-file-alist '(("ben@twos.dev" . "~/icloud/Documents/storage/org/schedule.org")))
	    
  (require 'org-gcal)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-15" class="outline-3">
<h3 id="headline-15">
Project management
</h3>
<div id="outline-text-headline-15" class="outline-text-3">
<p>
Because Emacs runs as a daemon with any number of frames connected to
it, it doesn't place the same emphasis on a working directory as
editors like Vim.</p>
<p>
This makes things a bit sticky when e.g. trying to open a new file
while looking at <code class="verbatim">~/myproject/config/dev.yml</code>; you'd generally expect
the starting directory for the search to be <code class="verbatim">~/myproject</code>, but Emacs
instead starts at <code class="verbatim">~/myproject/config</code>, not knowing the difference in
significance between the two and being unable to lean on a stable
working directory given that you also have <code class="verbatim">~/anotherproject/main.go</code>
open in another buffer.</p>
<p>
<a href="https://github.com/bbatsov/projectile" target="_blank"><code class="verbatim">projectile</code></a> is a fantastic Emacs package that fixes this. At its most
basic level it brings a hidden Emacs feature (<code class="verbatim">project.el</code>) into the
limelight and attaches a bunch of modern quality-of-life improvements
to it. It uses a combination of autodetection and prompts to establish
what project a given file belongs to.</p>
<p>
With that new relationship comes project-scoped commands and actions,
like fuzzy jump-to-file, jumping between a file and its counterpart
test file, closing every buffer for a project, etc.</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (straight-use-package 'projectile)
  (require 'projectile)
  (define-key projectile-mode-map (kbd "s-p") 'projectile-command-map)
  (projectile-mode +1)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-16" class="outline-3">
<h3 id="headline-16">
Newbie Helpers
</h3>
<div id="outline-text-headline-16" class="outline-text-3">
<p>
These packages help me out as a new Emacs user.</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  ;; Try out packages without installing them
  (straight-use-package 'try)

  ;; Show available key sequence paths forward in minibuffer
  (straight-use-package 'which-key)
  (which-key-mode)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-17" class="outline-3">
<h3 id="headline-17">
Efficiencies
</h3>
<div id="outline-text-headline-17" class="outline-text-3">
<p>Use <code class="verbatim">C-=</code> to smartly select based on semantics of the language being selected.</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (straight-use-package 'expand-region)
  (global-set-key (kbd "C-=") 'er/expand-region)
</pre>
</div>
</div>
<p>
Use <a href="https://github.com/emacsorphanage/god-mode" target="_blank"><code class="verbatim">god-mode</code></a>, which is like normal mode in Vim but using traditional Emacs
bindings. It has these effects:</p>
<ul>
<li>All <code class="verbatim">C-</code> are removed from commands (e.g. <code class="verbatim">x s</code> performs <code class="verbatim">C-x C-s</code>)</li>
<li><code class="verbatim">g</code> modifies the next keystroke with <code class="verbatim">M-</code> (e.g. <code class="verbatim">g x</code> performs <code class="verbatim">M-x</code>)</li>
<li><code class="verbatim">G</code> modifies the next keystroke with <code class="verbatim">C-M-</code> (e.g. <code class="verbatim">G x</code> performs <code class="verbatim">C-M-x</code>)</li>
<li><code class="verbatim">SPC</code> prevents all of the above for the remainder of the key sequence (e.g. <code class="verbatim">x
SPC s</code> performs <code class="verbatim">C-x s</code>)</li>
<li>Starting a key sequence with <code class="verbatim">C-</code> stops God mode from affecting that sequence
(e.g. <code class="verbatim">C-x C-s</code> performs itself: <code class="verbatim">C-x C-s</code>)</li>
</ul>
<p>The point of god-mode is to prevent "Emacs pinky",
but after 10 years of Vim I honestly just need some level of protection between
me and inserting random characters into files unknowingly,
especially with hard auto-save on.</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (straight-use-package 'god-mode)
  (require 'god-mode)
  (define-key god-local-mode-map (kbd "i") #'god-local-mode)
  (define-key god-local-mode-map (kbd ".") #'repeat)
  (global-set-key (kbd "&lt;escape&gt;") #'god-local-mode)
  (setq-default god-mode-enable-function-key-translation nil) ; Except function keys

  ;; Change cursor to box outside god mode, bar inside it
  (defun my-god-mode-update-cursor-type ()
    (setq-default cursor-type (if (or god-local-mode buffer-read-only) 'box 'bar)))
  (add-hook 'post-command-hook #'my-god-mode-update-cursor-type)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-18" class="outline-3">
<h3 id="headline-18">
Modern Niceties
</h3>
<div id="outline-text-headline-18" class="outline-text-3">
<p>Emacs was written in 1976, and it takes a bit of configuration to get
up to speed with modern standard practices.</p>
<p>
  <code class="verbatim">savehist</code> generically allows saving minibuffer histories (e.g.
  frecency data) across restarts:</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (straight-use-package 'savehist) ; Save minibuffer histories; pairs with frecency of vertico
</pre>
</div>
</div>
<p>
<code class="verbatim">dired-sidebar</code> shows a directory explorer a la NERDTree.</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (straight-use-package 'dired-sidebar)
  (require 'dired-sidebar)
  (dired-sidebar-toggle-sidebar)
</pre>
</div>
</div>
<p>
<code class="verbatim">super-save</code> auto-saves buffers when they lose focus.
Note that Emacs has a built-in auto-save,
but it only refers to saving to temporary files.</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (straight-use-package 'super-save)
  (super-save-mode +1)
  (setq super-save-auto-save-when-idle t)
</pre>
</div>
</div>
<p>
<code class="verbatim">winner-mode</code> is built into Emacs but disabled by default.
When enabled, it tracks changes to window configurations and allows undoing with
<code class="verbatim">C-c left</code>.</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (winner-mode)
</pre>
</div>
</div>
<p>
<code class="verbatim">undo-fu</code> makes Emacs's undo feature more modern:</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (straight-use-package 'undo-fu)
  (global-unset-key (kbd "C-z"))
  (global-set-key (kbd "C-z")   'undo-fu-only-undo)
  (global-set-key (kbd "C-s-z") 'undo-fu-only-redo)
  (straight-use-package 'undo-fu-session)
  (undo-fu-session-global-mode)
</pre>
</div>
</div>
<p>
We'll install <a href="https://github.com/oantolin/orderless" target="_blank"><code class="verbatim">orderless</code></a> for completion:</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>  (straight-use-package 'orderless)
</pre>
</div>
</div>
<p>
And <a href="https://github.com/minad/vertico" target="_blank"><code class="verbatim">vertico</code></a> for more completion improvements:</p>
<div class="src src-emacs-lisp">
<div class="highlight">
<pre>(straight-use-package 'vertico)
(vertico-mode)
</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-19" class="outline-2">
<h2 id="headline-19">
The End
</h2>
<div id="outline-text-headline-19" class="outline-text-2">
<p>
Thanks for reading my Emacs config! Please let me know if you have any
questions or improvement suggestions! <a href="mailto:ben@twos.dev">ben@twos.dev</a></p>
</div>
</div>
</div>
</div>
</body></html>
      </article>
      <footer>
        <p class="mb-0">
          <small>
            <i>
              
                
                  source:
                  <a
                    href="https://github.com/glacials/dotfiles/blob/main/dot_config/emacs/config.org"
                    >~/.config/emacs/config.org</a
                  >
                
              
              <br />
              
                
                  published
                  2023 February
                  
                    / last updated
                    2023 March
                  
                
              
            </i>
          </small>
        </p>
        <p class="mt-0 muted">
          <small>
            <a href="#">to top</a>
            
              / <a href="/">back home</a>
            
            /
            <a href="https://ko-fi.com/glacials" target="_blank"
              >buy me a coffee</a
            ></small
          >
        </p>
      </footer>
    </div>
    <script
  crossorigin="anonymous"
  defer
  integrity="sha384-X/XCfMm41VSsqRNQgDerQczD69XqmjOOOwYQvr/uuC+j4OPoNhVgjdGFwhvN02Ja"
  src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js"
></script>
<script
  crossorigin="anonymous"
  defer
  integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR"
  onload="renderMathInElement(document.body);"
  src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js"
></script>
<script>
  
  if (document.location.hostname == "localhost") {
    const wsurl = "ws://localhost:8100/ws";
    const socket = new WebSocket(wsurl);
    socket.addEventListener("message", (event) => location.reload());
    socket.addEventListener("close", (event) => {
      console.log("backup initiating");
      setInterval(() => {
        const sock = new WebSocket("ws://localhost:8100/ws");
        sock.addEventListener("open", (event) => {
          location.reload();
        });
      }, 1000);
    });
  }

  
  
  
  
  
  
  
  
  
  if (document.location.pathname === "/winter") {
    window.location.replace("https://pkg.go.dev/twos.dev/winter");
  }

  
  document.addEventListener("keydown", (event) => {
    switch (event.key) {
      case "ArrowLeft":
        const moveLeftFrom = document.querySelector(
          ".gallery-item input:checked",
        );
        const moveLeftTo =
          document.querySelector(
            ".gallery-item:has(+ .gallery-item input:checked) input[type=checkbox]",
          ) ??
          document.querySelector(
            ".gallery-item:has(+ h2 + .gallery-item input:checked) input[type=checkbox]",
          );
        if (moveLeftFrom) {
          moveLeftFrom.checked = false;
        }
        if (moveLeftTo) {
          moveLeftTo.checked = true;
        }
        break;
      case "ArrowRight":
        const moveRightFrom = document.querySelector(
          ".gallery-item input:checked",
        );
        const moveRightTo =
          document.querySelector(
            ".gallery-item:has(input:checked) + .gallery-item input[type=checkbox]",
          ) ??
          document.querySelector(
            ".gallery-item:has(input:checked) + h2 + .gallery-item input[type=checkbox]",
          );
        if (moveRightFrom) {
          moveRightFrom.checked = false;
        }
        if (moveRightTo) {
          moveRightTo.checked = true;
        }
        break;
      case " ": 
      case "Escape":
        const current = document.querySelector(".gallery-item input:checked");
        if (current) {
          event.preventDefault();
          current.checked = false;
        }
        break;
    }
  });
</script>

  </body>
</html>
