<!doctype html>
<html lang="en">
  <head>
    <meta
  name="go-import"
  content="twos.dev
           git https://github.com/glacials/twos.dev"
/>
<meta
  name="go-source"
  content="twos.dev
           https://github.com/glacials/twos.dev
           https://github.com/glacials/twos.dev/tree/main{/dir}
           https://github.com/glacials/twos.dev/blob/main{/dir}/{file}#L{line}"
/>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<meta name="description" content="The Sunday Pivot" />
<link
  rel="alternate"
  type="application/rss+xml"
  title="twos.dev"
  href="/feed.rss"
/>
<link
  rel="alternate"
  type="application/atom+xml"
  title="twos.dev"
  href="/feed.atom"
/>
<title>Ben Carlsson / The Sunday Pivot</title>
<link rel="stylesheet" href="/style.css" />

<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css"
  integrity="sha384-Xi8rHCmBmhbuyyhbI88391ZKP2dmfnOl4rT9ZfRI7mLTdk1wblIUnrIq35nqwEvC"
  crossorigin="anonymous"
/>
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png?v=2" />
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png?v=2" />
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png?v=2" />
<link rel="manifest" href="/site.webmanifest?v=2" />
<link rel="mask-icon" href="/safari-pinned-tab.svg?v=2" color="#5bbad5" />
<link rel="shortcut icon" href="/favicon.ico?v=2" />
<meta name="msapplication-TileColor" content="#da532c" />
<meta name="theme-color" content="#ffffff" />


  </head>

  <body>
    <div class="container">
      <nav class="primary"><div class="hierarchy">
      <div class="breadcrumb">
        <a href="/"><div class="nav-text">Ben Carlsson</div></a>
      </div></div>
    <div class="breadcrumb title">
      <a href="/yourbase.html"><h1>The Sunday Pivot</h1></a>
    </div></nav>

      <article>
        
        
          <div class="draft">Draft</div>
        
        
        
        <html><head></head><body>

<p>One sleepy Sunday morning in January 2021,
I decided to write a Python library.
This was no ordinary Python library,
since its purpose was the same as that of the entire company of YourBase,
the startup I worked at at the time.</p>

<h1>Part 1</h1>

<p>YourBase,
which I had joined eight months prior,
had a mission to accelerate software testing speed for monolithic applications.
When I joined they already had some really clever techniques for doing this.</p>

<p>The bulk of the magic happened in some low-level tracing code written in C and Rust,
which operated at the kernel level and so required that we control the build machine.
The magic code would track which specific test was currently executing,
and inspect the function calls made during the life of the test.
If a function was called during a test,
that test was said to depend on that function.
And if no function depended on by a test had changed since last time the test was run,
that test could be completely skipped.
There are some edge cases to this like environment variables and opened file pointers,
but that's the simple explanation.</p>

<p>That we need control of the build machine necessitated that the build machine be part of a CI pipeline,
which the company had custom-built.
This meant on top of the build tracing tech we needed to spin our own CI infrastructure from scratch,
including UI,
user and role management,
log streaming,
etc.</p>

<p>Worse,
it was a monumental effort to convince customers to move entire CI systems,
especially when our target customers by definition had large and monolithic code bases;
there was little expectation that any would be nimble enough to swap entire CI platforms.
Hindsight is 20/20, but it's clear now that it took a special type of company to agree to become a customer of ours.</p>

<p>Our salesperson had identified this problem,
and was desperate for a solution.</p>

<h2>Part 2</h2>

<p>On that fateful post-holiday Sunday,
I had an itch.
Our kernel-level tricks were brilliant and effective,
but the effort of onboarding was stopping most prospective customers from even <em>seeing</em> the benefit,
let alone diving head first into swapping over to it.</p>

<p>I began wondering,
could I get an 80/20 tradeoff here?
Are there enough tracing tools,
or at least undocumented hooks,
in Python for me to reproduce even a fraction of our C code's effectiveness?</p>

<p>Through some research and thought experiments I arrived at an unexpected starting point:
code coverage.
Clearly, the existence of any tool that generates code coverage reports<span style="font-family: sans-serif">—</span>line-by-line analysis of which lines of code that ran during a test<span style="font-family: sans-serif">—</span>implied the existence of tracing tools friendly enough to allow another body of code to skip tests.</p>
</body></html>
      </article>
      <footer>
        <p>
          <small>
            <i>
              
							
                source:
                <a
                  href="https://github.com/glacials/twos.dev/blob/main/src/cold/yourbase.md"
                  target="_blank"
                  >src/cold/yourbase.md</a
														>
								
              
              <br />
              
                published
                2023 December
                
              
            </i>
          </small>
        </p>
      </footer>
    </div>
    <script
  crossorigin="anonymous"
  defer
  integrity="sha384-X/XCfMm41VSsqRNQgDerQczD69XqmjOOOwYQvr/uuC+j4OPoNhVgjdGFwhvN02Ja"
  src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js"
></script>
<script
  crossorigin="anonymous"
  defer
  integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR"
  onload="renderMathInElement(document.body);"
  src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js"
></script>
<script>
  
  if (document.location.hostname == "localhost") {
    const wsurl = "ws://localhost:8100/ws";
    const socket = new WebSocket(wsurl);
    socket.addEventListener("message", (event) => location.reload());
    socket.addEventListener("close", (event) => {
      console.log("backup initiating");
      setInterval(() => {
        const sock = new WebSocket("ws://localhost:8100/ws");
        sock.addEventListener("open", (event) => {
          location.reload();
        });
      }, 1000);
    });
  }

  
  
  
  
  
  
  
  
  
  if (document.location.pathname === "/winter") {
    window.location.replace("https://pkg.go.dev/twos.dev/winter");
  }

  
  document.addEventListener("keydown", (event) => {
    switch (event.keyCode) {
      case 37: 
        const moveLeftFrom = document.querySelector(
          ".gallery-item input:checked",
        );
        const moveLeftTo = document.querySelector(
          ".gallery-item:has(+ .gallery-item input:checked) input[type=checkbox]",
        );
        if (moveLeftFrom) {
          moveLeftFrom.checked = false;
        }
        if (moveLeftTo) {
          moveLeftTo.checked = true;
        }
        break;
      case 39: 
        const moveRightFrom = document.querySelector(
          ".gallery-item input:checked",
        );
        const moveRightTo = document.querySelector(
          ".gallery-item:has(input:checked) + .gallery-item input[type=checkbox]",
        );
        if (moveRightFrom) {
          moveRightFrom.checked = false;
        }
        if (moveRightTo) {
          moveRightTo.checked = true;
        }
        break;
      case 27: 
        const current = document.querySelector(".gallery-item input:checked");
        if (current) {
          current.checked = false;
        }
        break;
    }
  });
</script>

  </body>
</html>
